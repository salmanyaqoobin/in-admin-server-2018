{"version":3,"sources":["server/user/user.model.js"],"names":["async","require","Promise","mongoose","httpStatus","APIError","validator","jwt","_","bcrypt","UserSchema","Schema","email","type","String","required","trim","minlength","unique","validate","isAsync","isEmail","message","password","name","mobileNumber","region","enum","default","city","is_active","createdAt","Date","now","coupons_consumed","coupon_id","Types","ObjectId","coupon_name","prize_achieved","prize_id","prize_name","prize_image","points_achieved","Number","tokens","access","token","SALT_ROUNDS","pre","next","user","isModified","genSalt","err","salt","hash","method","toJSON","userObject","toObject","generateAuthToken","sign","_id","toHexString","exp","Math","floor","process","env","JWT_SECRET","toString","push","save","then","removeToken","update","$pull","multi","catch","e","reject","statics","get","id","findById","exec","NOT_FOUND","list","skip","limit","find","sort","findByToken","User","decode","verify","findOne","findByTokenPassword","select","changePassword","currentPassword","newPassword","userHashedPassword","console","log","findWithPassword","resolve","criteria","compare","allow","userPassowrd","res","findByCredentials","model","module","exports"],"mappings":"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","file":"user.model.js","sourceRoot":"../../../../.."}